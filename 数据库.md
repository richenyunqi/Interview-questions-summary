# 数据库

## 数据模型有哪几种？

关系模型、层次模型、网状模型

## 数据库完整性

数据库的完整性是指数据的正确性和相容性。

1. 完整性：为了防止数据库中存在不符合语义（不正确）的数据。
2. 安全性：为了保护数据库防止恶意破坏和非法存取。

## 视图

视图是从一个或几个基本表（或视图）导出的表。它与基本表不同，是一个虚表。数据库只存放视图的定义，而不存放视图对应的数据，这些数据仍存放在原来的基本表中。所以基本表中的数据发生变化，从视图中查询出的数据也就随之改变了。从这个意义上讲，视图就像一个窗口，透过它可以看到数据库中自己感兴趣的数据及其变化。

视图的好处：

1. 视图能简化用户操作

   视图机制使用户可以将注意力集中在所关心地数据上。如果这些数据不是直接来自基本表，则可以通过定义视图，使数据库看起来结构简单、清晰，并且可以简化用户的的数据查询操作。换句话说，用户所作的只是对一个虚表的简单查询，而这个虚表是怎样得来的，用户无需了解。

2. 视图使用户能以多种角度看待同一数据

   视图机制能使不同的用户以不同的方式看待同一数据，当许多不同种类的用户共享同一个数据库时，这种灵活性是非常必要的。

3. 视图对重构数据库提供了一定程度的逻辑独立性

   数据的物理独立性是指用户的应用程序不依赖于数据库的物理结构。数据的逻辑独立性是指当数据库重构造时，如增加新的关系或对原有的关系增加新的字段，用户的应用程序不会受影响。层次数据库和网状数据库一般能较好地支持数据的物理独立性，而对于逻辑独立性则不能完全的支持。

   在关系数据库中，数据库的重构造往往是不可避免的。重构数据库最常见的是将一个基本表“垂直”地分成多个基本表。如果定义了视图，尽管数据库的逻辑结构改变了，但应用程序不必修改，因为新建立的视图定义为用户原来的关系，使用户的外模式保持不变，用户的应用程序通过视图仍然能够查找数据。当然，视图只能在一定程度上提供数据的逻辑独立，比如由于视图的更新是有条件的，因此应用程序中修改数据的语句可能仍会因为基本表构造的改变而改变。

4. 视图能够对机密数据提供安全保护

   有了视图机制，就可以在设计数据库应用系统时，对不同的用户定义不同的视图，使机密数据不出现在不应该看到这些数据的用户视图上。这样视图机制就自动提供了对机密数据的安全保护功能。

5. 适当的利用视图可以更清晰地表达查询

## 索引

索引是对数据库表中一列或多列的值进行排序的一种结构。使用索引可快速访问数据库表中的特定信息。建立索引的操作就是指定一个或者多个字段，以便于按这个字段中的值来检索数据。

建立索引的优点：

1. 大大加快数据的检索速度；
2. 创建唯一性索引，保证数据库表中每一行数据的唯一性；
3. 加速表和表之间的连接；
4. 在使用分组和排序子句进行数据检索时，可以显著减少查询中分组和排序的时间。

索引的缺点：
索引占用磁盘空间，并且降低添加、删除、更新行的速度。大多数情况下，索引的速度优势大大超过它的不足之处。但是如果程序非常频繁的更新数据或磁盘空间有限，则需要限制索引的数量。

索引类型：根据数据库的功能，可以在数据库设计器中创建四种索引：唯一索引、非唯一索引、主键索引和聚集索引。 尽管唯一索引有助于定位信息，但为获得最佳性能结果，建议改用主键或唯一约束。

1. 唯一索引：唯一索引是不允许其中任何两行具有相同索引值的索引。当现有数据中存在重复的键值时，大多数数据库不允许将新创建的唯一索引与表一起保存。数据库还可能防止添加将在表中创建重复键值的新数据。例如，如果在 employee 表中职员的姓 (lname) 上创建了唯一索引，则任何两个员工都不能同姓。
2. 非唯一索引：非唯一索引是相对唯一索引，允许其中任何两行具有相同索引值的索引。当现有数据中存在重复的键值时，数据库是允许将新创建的索引与表一起保存。这时数据库不能防止添加将在表中创建重复键值的新数据。
3. 主键索引：数据库表经常有一列或列组合，其值唯一标识表中的每一行。该列称为表的主键。在数据库关系图中为表定义主键将自动创建主键索引，主键索引是唯一索引的特定类型。该索引要求主键中的每个值都唯一。当在查询中使用主键索引时，它还允许对数据的快速访问。
4. 聚集索引（也叫聚簇索引）：在聚集索引中，表中行的物理顺序与键值的逻辑（索引）顺序相同。一个表只能包含一个聚集索引。如果某索引不是聚集索引，则表中行的物理顺序与键值的逻辑顺序不匹配。与非聚集索引相比，聚集索引通常提供更快的数据访问速度。

## 数据库范式？

目前关系数据库有六种范式。

1. 第一范式：实体中的某个属性不能有多个值或者不能有重复的属性。
2. 第二范式：数据库表中的每个实例都必须可以唯一的区分，即必须有主码。
3. 第三范式：一个数据库表中不含有在其他表中已包含的非主码信息。
4. 第四方式：如果对于 R 的每个非平凡多值依赖 X->->Y，X 都含有候选码。

## 连接方式？

1. left join （左连接）：返回包括左表中的所有记录和右表中连接字段相等的记录。
2. right join （右连接）：返回包括右表中的所有记录和左表中连接字段相等的记录。
3. inner join （等值连接或者叫内连接）：只返回两个表中连接字段相等的行。
4. full join （全外连接）：返回左右表中所有的记录和左右表中连接字段相等的记录。

## 数据库事务正确执行的四个要素（ACID 特性）

引入事务是为了解决并行执行的问题

1. 原子性：事务是一个原子操作单元，其对数据的修改，要么全都执行，要么全都不执行
2. 一致性：事务开始前和结束后，数据库的完整性约束没有被破坏。
3. 隔离性：同一时间，只允许一个事务请求同一数据，不同的事务之间彼此没有任何干扰。
4. 持久性：事务完成后，事务对数据库的所有更新将被保存到数据库，不能回滚。

## 事务的并发问题

1. 脏读：脏读就是指当一个事务正在访问数据，并且对数据进行了修改，而这种修改还没有提交到数据库中，这时，另外一个事务也访问这个数据，然后使用了这个数据。
2. 不可重复读：是指在一个事务内，多次读同一数据。在这个事务还没有结束时，另外一个事务也访问该同一数据。那么，在第一个事务中的两次读数据之间，由于第二个事务的修改，那么第一个事务两次读到的的数据可能是不一样的。例如，一个编辑人员两次读取同一文档，但在两次读取之间，作者重写了该文档。当编辑人员第二次读取文档时，文档已更改。如果只有在作者全部完成编写后编辑人员才可以读取文档，则可以避免该问题。
3. 幻读：是指当事务不是独立执行时发生的一种现象，例如第一个事务对一个表中的数据进行了修改，这种修改涉及到表中的全部数据行。同时，第二个事务向表中插入一行新数据。那么，以后就会发生操作第一个事务的用户发现表中还有没有修改的数据行，就好像发生了幻觉一样。

## 事务隔离级别

| 事务隔离级别                 | 脏读 | 不可重复读 | 幻读 |
| ---------------------------- | ---- | ---------- | ---- |
| Read uncommitted（读未提交） | 是   | 是         | 是   |
| Read committed（读提交）     | 否   | 是         | 是   |
| Repeatable read （重复读）   | 否   | 否         | 是   |
| Serializable （串行化）      | 否   | 否         | 否   |

## SQL 执行顺序

SQL 的执行顺序：from---where--group by---having---select---order by

## 为什么选择 B+树作为索引结构

- Hash 索引：Hash 索引底层是哈希表，哈希表是一种以 key-value 存储数据的结构，所以多个数据在存储关系上是完全没有任何顺序关系的，所以，对于区间查询是无法直接通过 Hash 索引查询的，就需要全表扫描。所以，哈希索引只适用于等值查询的场景。而 B+ 树是一种多路平衡查询树，所以他的节点是天然有序的（左子节点小于父节点、父节点小于右子节点），所以对于范围查询的时候不需要做全表扫描
- 二叉查找树：解决了排序的基本问题，但是由于无法保证平衡，可能退化为链表。
- 平衡二叉树：通过旋转解决了平衡的问题，但是旋转操作效率太低。
- 红黑树：通过舍弃严格的平衡和引入红黑节点，解决了 AVL 旋转效率过低的问题，但是在磁盘等场景下，树仍然太高，IO 次数太多。
- B+树：在 B 树的基础上，将非叶节点改造为不存储数据纯索引节点，进一步降低了树的高度；此外将叶节点使用指针连接成链表，范围查询更加高效。

## B+树的叶子节点都可以存哪些东西

可能存储的是整行数据，也有可能是主键的值。B+树的叶子节点存储了整行数据的是主键索引，也被称之为聚簇索引。而索引 B+ Tree 的叶子节点存储了主键的值的是非主键索引，也被称之为非聚簇索引
